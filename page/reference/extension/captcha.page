---
title: Captcha
description: Form protection using captcha. Captcha is a type of challenge-response test used in computing to determine whether or not the user is human.
icon: data:image/png;base64,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

dependency:
  extension:
    - asset
...

### Usage

#### Input

~~~ .html
<form method="post">
  <p><?php echo Captcha::math('foo'); ?></p>
  <p><?php echo Form::text('captcha'); ?></p>
  <p><?php echo Form::submit(null, null, 'Submit'); ?></p>
</form>
~~~

#### Output

~~~ .php.xmp
Captcha::check($input, $id, $fail = false);
~~~

~~~ .php
if (Captcha::check(HTTP::post('captcha'), 'foo') !== false) {
    // Passed the test!
}
~~~

### Features

#### Math Captcha

Form protection using math question.

~~~ .php.xmp
Captcha::math(
    $id = null,
    $min = 1,
    $max = 10,
    $text = [],
    $format = '%{a}% %{?}% %{b}%'
);
~~~

Result:

~~~ .html
<span class="captcha captcha-math" id="captcha:foo">2 &#x002B; 5</span>
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$min` | Range minimum of the randomly generated number.
`$max` | Range maximum of the randomly generated number.
`$text` | List of text used to alter the output number.
`$format` | `%{a}%` for the first random number; `%{b}%` for the second random number; `%{?}%` for the math operator.

Example of using the `$text` parameter:

~~~ .php
echo Captcha::math('foo', 1, 5, [
    1 => 'one',
    2 => 'two',
    3 => 'three',
    4 => 'four',
    5 => 'five',
    '+' => 'plus',
    '-' => 'minus'
]);
~~~

Result will be like:

~~~ .html
<span class="captcha captcha-math" id="captcha:foo">one plus five</span>
~~~

#### Text Captcha

Form protection using text image question.

~~~ .php.xmp
Captcha::text(
    $id = null,
    $background = false,
    $color = '000',
    $size = 16,
    $width = 6,
    $height = 2,
    $text = 7,
    $font = '0'
);
~~~

Result:

~~~ .html
<img src="%{url}%/captcha.png?id=foo" alt="foo" class="captcha captcha-text" id="captcha:foo" width="96" height="32">
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$background` | Text background color using HEX color code without the hash prefix or `false` for transparent background.
`$color` | Text color using HEX color code without the hash prefix.
`$size` | Font size in `px`.
`$width` | Image width in `em` relative to `$size`.
`$height` | Image height in `em` relative to `$size`.
`$text` | Text length.
`$font` | True type font file name without the file extension, stored in `lot\extend\captcha\lot\asset\ttf`.

> **Note:** I have removed some of the glyphs in the font to make it only contains `[a-zA-Z0-9]` to reduce the file size.

#### Token Captcha

A type of captcha that will only return a token hash.

~~~ .php.xmp
Captcha::token(
    $id = null,
    $hash = null,
    $html = true
);
~~~

Result:

~~~ .html
<span class="captcha captcha-token" id="captcha:foo" contenteditable>1c6948fae7c880eb2dfa4f1b8ecb0e5ebc748d93</span>
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$hash` | Set random value here, as the token hash, or use the default hash generated by [`Guardian::hash()`][link:../class/guardian/hash].
`$html` | Set to `false` to output only the token hash.

Example of using the `$hash` parameter:

~~~ .php
echo Captcha::token('foo', uniqid());
~~~

~~~ .php
echo Captcha::token('foo', array_rand([0, 1, 2, 3, 4, 5]));
~~~

~~~ .php
echo Captcha::token('foo', function($hash) {
    return $hash . time();
});
~~~

The output token will becomes the answer. Do whatever you want with this. Here are some examples:

As copy and paste captcha:

~~~ .html
<form method="post">
  <p>Copy the token below and paste it to the text area provided.</p>
  <p><?php echo Captcha::token('foo'); ?></p>
  <p><?php echo Form::textarea('captcha'); ?></p>
  <p><?php echo Form::submit(null, null, 'Submit'); ?></p>
</form>
~~~

As toggle captcha:

~~~ .php
<?php echo Form::checkbox('captcha', Captcha::token('foo', null, false), false, 'I am not a robot.'); ?>
~~~