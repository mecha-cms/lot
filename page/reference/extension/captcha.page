---
title: Captcha
description: Form protection using captcha.
icon: M21,9H15V22H13V16H11V22H9V9H3V7H21M12,2A2,2 0 0,1 14,4A2,2 0 0,1 12,6C10.89,6 10,5.1 10,4C10,2.89 10.89,2 12,2Z

dependency:
  extension:
    - asset
...

Captcha is a type of challenge-response test used in computing to determine whether or not the user is human.

### Usage

#### Input

~~~ .html
<form method="post">
  <p><?php echo Captcha::math('foo'); ?></p>
  <p><?php echo Form::text('captcha'); ?></p>
  <p><?php echo Form::submit(null, null, 'Submit'); ?></p>
</form>
~~~

#### Output

~~~ .php.xmp
Captcha::check($input, $id, $fail = false);
~~~

~~~ .php
if (Captcha::check(HTTP::post('captcha'), 'foo') !== false) {
    // Passed the test!
}
~~~

### Features

#### Math Captcha

Form protection using math question.

~~~ .php.xmp
Captcha::math(
    $id = null,
    $min = 1,
    $max = 10,
    $text = [],
    $format = '%{a}% %{?}% %{b}%'
);
~~~

Result:

~~~ .html
<span class="captcha captcha-math" id="captcha:foo">2 &#x002B; 5</span>
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$min` | Range minimum of the randomly generated number.
`$max` | Range maximum of the randomly generated number.
`$text` | List of text used to alter the output number.
`$format` | `%{a}%` for the first random number; `%{b}%` for the second random number; `%{?}%` for the math operator.

Example of using the `$text` parameter:

~~~ .php
echo Captcha::math('foo', 1, 5, [
    1 => 'one',
    2 => 'two',
    3 => 'three',
    4 => 'four',
    5 => 'five',
    '+' => 'plus',
    '-' => 'minus'
]);
~~~

Result will be like:

~~~ .html
<span class="captcha captcha-math" id="captcha:foo">one plus five</span>
~~~

#### Text Captcha

Form protection using text image question.

~~~ .php.xmp
Captcha::text(
    $id = null,
    $background = false,
    $color = '000',
    $size = 16,
    $width = 6,
    $height = 2,
    $text = 7,
    $font = '0'
);
~~~

Result:

~~~ .html
<img src="http://127.0.0.1/captcha.png?id=foo" alt="foo" class="captcha captcha-text" id="captcha:foo" width="96" height="32">
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$background` | Text background color using HEX color code without the hash prefix or `false` for transparent background.
`$color` | Text color using HEX color code without the hash prefix.
`$size` | Font size in `px`.
`$width` | Image width in `em` relative to `$size`.
`$height` | Image height in `em` relative to `$size`.
`$text` | Text length.
`$font` | True type font file name without the file extension, stored in `lot\asset\ttf`.

> **Note:** I have removed some of the glyphs in the font to make it only contains `[a-zA-Z0-9]` to reduce the file size.

#### Token Captcha

A type of captcha that simply return a token hash.

~~~ .php.xmp
Captcha::token(
    $id = null,
    $hash = null,
    $html = true
);
~~~

Result:

~~~ .html
<span class="captcha captcha-token" id="captcha:foo" contenteditable>1c6948fae7c880eb2dfa4f1b8ecb0e5ebc748d93</span>
~~~

Parameter | Description
--------- | -----------
`$id` | The captcha ID.
`$hash` | Set random value here as the token hash, or use the default hash generated by [`Guardian::hash()`][link:../class/guardian/hash].
`$html` | Set to `false` to output only the token hash.

Example of using the `$hash` parameter:

~~~ .php
echo Captcha::token('foo', uniqid());
~~~

~~~ .php
echo Captcha::token('foo', array_rand([0, 1, 2, 3, 4, 5]));
~~~

~~~ .php
echo Captcha::token('foo', function($hash) {
    return $hash . time();
});
~~~

The output token will becomes the answer. Do whatever you want with this. Here are some examples:

As copy and paste captcha:

~~~ .html
<form method="post">
  <p>Copy the token below and paste it to the text area provided.</p>
  <p><?php echo Captcha::token('foo'); ?></p>
  <p><?php echo Form::textarea('captcha'); ?></p>
  <p><?php echo Form::submit(null, null, 'Submit'); ?></p>
</form>
~~~

As toggle captcha:

~~~ .php
<?php echo Form::check('captcha', Captcha::token('foo', null, false), false, 'I am not a robot.'); ?>
~~~